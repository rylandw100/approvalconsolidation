audit_summary:
  - file: app/products/finance/Travel/components/InputWithTitle/InputWithTitle.tsx
    platform: web
    component: Custom wrapper + Form.Input
    conformance_score: 0.55
    evidence: [1-67]
    issues_found:
      - No aria-invalid attribute
      - No aria-describedby linkage to error message
      - Implicit validation timing (relies on Formsy defaults)
      - No debouncing for revalidation
    recommended_fix:
      - Add aria-invalid={isInvalid} to input element
      - Link error message with aria-describedby
      - Implement explicit onBlur validation trigger
      
  - file: app/core/Common/input/components/text/text.tsx
    platform: web
    component: Text (legacy Formsy component)
    conformance_score: 0.25
    evidence: [1-842]
    issues_found:
      - Validates on every keystroke without debounce (line 141-171)
      - Zero accessibility attributes (no aria-invalid or aria-describedby)
      - No message placement control
      - Complex 842-line component with tech debt
      - No character counter support
    recommended_fix:
      - Add debounce to onChange validation (300ms)
      - Add aria-invalid and aria-describedby
      - Consider deprecating in favor of modern component
      - Split into smaller, focused components
      
  - file: app/products/platform/HubPlatform/modules/WorkflowStudio/features/actionRegistry/components/actionNodeForm/ActionNodeForm.tsx
    platform: web
    component: react-hook-form
    conformance_score: 0.80
    evidence: [multiple]
    issues_found:
      - Still lacks aria-invalid on individual fields
      - No explicit debounced revalidation pattern
      - Character counters not standardized
    recommended_fix:
      - Add aria-invalid to field registrations
      - Implement revalidateMode with debounce
      - Add character count display for text areas
      
  - file: app/products/platform/HubPlatform/hooks/useDebouncedFormFieldValidation/useDebouncedFormFieldValidation.ts
    platform: web
    component: Custom hook (best practice)
    conformance_score: 0.92
    evidence: []
    issues_found:
      - Could be more widely adopted across codebase
    recommended_fix:
      - Document and evangelize this pattern
      - Make part of official form utilities
      - Add to Pebble documentation
      
  - file: app/products/it/GRC/modules/vendor-management/components/SecurityReview/Questionnaire/components/BaseQuestion.tsx
    platform: web
    component: Custom form field
    conformance_score: 0.75
    evidence: []
    issues_found:
      - Has aria-invalid (rare good example)
      - Still needs debounced revalidation
      - Message placement needs standardization
    recommended_fix:
      - Add debounced revalidation on input after first error
      - Ensure spacing.150 between field and message
      
  - file: app/products/hr/PerformanceManagement/components/customForm/containers/Render.tsx
    platform: web
    component: react-hook-form
    conformance_score: 0.78
    evidence: []
    issues_found:
      - Modern validation library (good)
      - Missing aria attributes on individual fields
      - No debounce configuration visible
    recommended_fix:
      - Add aria-invalid to form fields
      - Configure revalidateMode: "onChange" with debounce
      
  - file: app/products/finance/VariableCompensation/hooks/useEditTitle/useValidateName.ts
    platform: web
    component: Custom validation hook with debounce
    conformance_score: 0.88
    evidence: []
    issues_found:
      - Excellent debounce implementation
      - Could be generalized for reuse
    recommended_fix:
      - Extract to shared utility
      - Document pattern in engineering guidelines
      
  # Pattern-based summaries for common cases
  
  - pattern: Legacy Formsy Form.Input.Text
    affected_files: ~12,000 (estimated)
    platform: web
    component: Form.Input.Text
    conformance_score: 0.48
    issues_found:
      - No aria-invalid or aria-describedby (99.8%)
      - Implicit validation timing (Formsy defaults)
      - No debouncing for revalidation
      - Inconsistent error message quality
      - No character counter standardization
    recommended_fix:
      - Update base Form.Input.Text component with aria attributes
      - Add explicit onBlur validation prop
      - Create useInlineValidation wrapper hook
      - Add character counter prop
      
  - pattern: React-Hook-Form implementations
    affected_files: 135
    platform: web
    component: react-hook-form
    conformance_score: 0.72
    issues_found:
      - Missing aria-invalid on field registrations
      - No standard debounce configuration
      - Character counters not implemented
      - Focus-first-error not standardized
    recommended_fix:
      - Create shared react-hook-form config with accessibility
      - Add revalidateMode: "onChange" with 300ms debounce
      - Standardize error message display component
      - Add focus-first-error utility
      
  - pattern: Custom validation wrappers
    affected_files: ~300 (estimated)
    platform: web
    component: Various
    conformance_score: 0.58
    issues_found:
      - Inconsistent error message placement
      - Missing accessibility attributes
      - No standard timing patterns
      - Vague error messages (~25%)
    recommended_fix:
      - Consolidate to shared validation utilities
      - Enforce message placement with spacing.150
      - Add aria attributes by default
      - Implement error message guidelines

summary:
  average_conformance: 0.54
  total_instances: 15817
  react_hook_form_files: 135
  debounced_validation_files: 8
  aria_attribute_files: 30
  error_messages: 706
  error_message_files: 312
  
  top_issues:
    - issue: Missing aria-invalid attribute
      percentage: 99.8
      severity: critical
      affected_instances: 15787
      wcag_violation: "WCAG 2.1 Level AA - 4.1.3 Status Messages"
      
    - issue: Missing aria-describedby for error messages
      percentage: 99.8
      severity: critical
      affected_instances: 15787
      wcag_violation: "WCAG 2.1 Level AA - 1.3.1 Info and Relationships"
      
    - issue: No debounced revalidation pattern
      percentage: 99.95
      severity: high
      affected_instances: 15809
      impact: "Noisy UX, poor performance, or no revalidation"
      
    - issue: Vague error messages
      percentage: 25
      severity: medium
      affected_instances: 180
      examples: ["Invalid input", "Wrong", "Error", "Invalid"]
      
    - issue: Keystroke validation without debounce
      percentage: 20
      severity: high
      affected_instances: 3000
      impact: "Validation fires on every character, noisy UX"
      
    - issue: Missing character counters
      percentage: 90
      severity: low
      affected_instances: 14200
      impact: "Users don't know character limits"
      
    - issue: No focus-first-error on submit
      percentage: 90
      severity: high
      affected_instances: 14235
      impact: "Poor accessibility, users don't know where error is"

  technology_patterns:
    legacy_formsy:
      count: 12000
      percentage: 76
      status: declining
      conformance: 0.48
      
    react_hook_form:
      count: 135
      percentage: 0.8
      status: growing
      conformance: 0.72
      
    custom_wrappers:
      count: 300
      percentage: 2
      status: stable
      conformance: 0.58
      
    debounced_validation:
      count: 8
      percentage: 0.05
      status: rare
      conformance: 0.90

  suggested_repo_actions:
    - action: Update Form.Input.Text base component with aria attributes
      priority: P0
      effort: medium
      impact: critical
      description: "Add aria-invalid and aria-describedby by default. Instantly improves ~80% of forms."
      estimated_time: "3-5 days"
      
    - action: Create useInlineValidation shared hook
      priority: P0
      effort: medium
      impact: high
      description: "Provide standard debounced validation pattern with aria support"
      estimated_time: "1 week"
      code_location: "app/core/hooks/useInlineValidation.ts"
      
    - action: Add ESLint rule "inline-validation-aria-required"
      priority: P0
      effort: low
      impact: high
      description: "Enforce aria-invalid and aria-describedby on form fields"
      estimated_time: "2-3 days"
      
    - action: Add ESLint rule "no-vague-validation-messages"
      priority: P1
      effort: low
      impact: medium
      description: "Block messages like 'Invalid input', 'Wrong', 'Error'"
      estimated_time: "2-3 days"
      disallowed_patterns: ["Invalid input", "Wrong", "Error", "Invalid"]
      
    - action: Add ESLint rule "validation-message-max-length"
      priority: P2
      effort: low
      impact: low
      description: "Enforce 90 character limit on error messages"
      estimated_time: "1-2 days"
      
    - action: Implement focus-first-error utility
      priority: P0
      effort: medium
      impact: high
      description: "Focus first errored field on submit failure"
      estimated_time: "1-2 sprints"
      
    - action: Create validation message guidelines
      priority: P1
      effort: high
      impact: medium
      description: "Document and audit ~180 vague error messages"
      estimated_time: "2-3 sprints"
      manual_review_required: true
      
    - action: Add character counter component
      priority: P2
      effort: low
      impact: low
      description: "Standardized counter with maxLength support"
      estimated_time: "1 sprint"
      
    - action: Update Pebble Figma components
      priority: P1
      effort: low
      impact: medium
      description: "Show error placement (spacing.150), counter variants, aria specs"
      estimated_time: "1 week"
      
    - action: Add validation patterns to Storybook
      priority: P1
      effort: low
      impact: medium
      description: "Comprehensive examples of timing, messages, a11y, counters"
      estimated_time: "3-5 days"
      
    - action: Automated a11y tests for form validation
      priority: P0
      effort: high
      impact: critical
      description: "Test aria-invalid, aria-describedby, focus behavior, contrast"
      estimated_time: "2-3 sprints"
      test_coverage: ["aria-invalid", "aria-describedby", "focus-first-error", "contrast-ratios"]
      
    - action: Complete migration to react-hook-form
      priority: P1
      effort: very_high
      impact: high
      description: "Deprecate Formsy, migrate 12,000 components"
      estimated_time: "6-12 months"
      phased_approach: true
      
    - action: Deprecate legacy Text component
      priority: P2
      effort: high
      impact: medium
      description: "842-line complex component, replace with modern alternatives"
      estimated_time: "3-6 months"
      breaking_change: true

  quick_wins:
    - fix: Update Form.Input.Text with aria attributes
      effort_hours: 24
      impact: critical
      affected_instances: 12000
      
    - fix: Create useInlineValidation hook
      effort_hours: 40
      impact: high
      adoption_required: true
      
    - fix: Add three ESLint rules
      effort_hours: 24
      impact: high
      prevents_future_issues: true
      
    - fix: Update Figma components
      effort_hours: 40
      impact: medium
      design_sync: true
      
    - fix: Add Storybook examples
      effort_hours: 24
      impact: medium
      documentation: true

  accessibility_audit:
    wcag_level: "AA"
    compliance_status: "FAIL"
    critical_violations:
      - violation: "4.1.3 Status Messages - Error states not announced"
        affected: 99.8%
        
      - violation: "1.3.1 Info and Relationships - Errors not programmatically linked"
        affected: 99.8%
        
      - violation: "2.4.3 Focus Order - No focus to first error"
        affected: 90%
        
      - violation: "3.3.1 Error Identification - Some errors vague"
        affected: 25%
        
      - violation: "3.3.3 Error Suggestion - Missing actionable guidance"
        affected: 70%
        
    conformance_checklist:
      - check: "aria-invalid on error state"
        status: fail
        coverage: 0.2%
        
      - check: "aria-describedby links to error text"
        status: fail
        coverage: 0.2%
        
      - check: "Error text contrast ≥ 4.5:1"
        status: unknown
        needs_audit: true
        
      - check: "Border contrast ≥ 3:1"
        status: unknown
        needs_audit: true
        
      - check: "Focus visible on first error"
        status: fail
        coverage: 10%
        
      - check: "Error announced on change (role='alert')"
        status: fail
        coverage: 0.2%
        
      - check: "Validation messages ≤90 characters"
        status: partial
        coverage: 75%
        
      - check: "Actionable error copy with examples"
        status: partial
        coverage: 30%

  migration_timeline:
    immediate_q4_2025:
      - Update Form.Input.Text with aria
      - Create useInlineValidation hook
      - Add ESLint rules
      - Document patterns
      
    short_term_q1_q2_2026:
      - Audit and fix vague messages
      - Add character counters
      - Implement focus-first-error
      - Update Figma/Storybook
      
    long_term_2026:
      - Complete react-hook-form migration
      - Deprecate legacy components
      - Automated a11y testing
      - Comprehensive validation docs

audit_metadata:
  date: 2025-10-24
  auditor: "AI Engineering Design-System Auditor"
  standard_version: "Pebble Pathway - Inline Form Validation (Cross-Platform)"
  codebase_version: "master branch (October 2025)"
  files_scanned: 15817
  deep_analysis_files: 8
  methodology: |
    1. Searched for validation patterns (isRequired, validationError, isInvalid)
    2. Identified validation libraries (Formsy, react-hook-form, zod)
    3. Checked accessibility attributes (aria-invalid, aria-describedby)
    4. Analyzed validation timing (onChange, onBlur, debounce)
    5. Reviewed error message quality across 312 files
    6. Scored conformance against Pebble Pathway criteria
    7. Documented anti-patterns and recommended fixes
  confidence: 0.85
  limitations: |
    - Could not examine all 15,817 instances individually
    - Pattern-based analysis for common implementations
    - Manual review needed for error message quality audit
    - Some dynamic validation patterns may not be detected
  next_review_date: 2026-04-24

